<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CHEMSAGA - Reset Password</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg, #0d0530, #260b7e, #0e0536);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .modal-content {
      background: #1a1a2e;
      padding: 40px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
      display: flex;
      flex-direction: column;
      gap: 15px;
      text-align: center;
      transition: all 0.6s ease-in-out;
      transform-origin: center;
    }

    .modal-content.morph {
      transform: scale(0.2) rotate(5deg);
      border-radius: 50%;
      opacity: 0;
    }

    h2 { margin: 0; }

    .code-container {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 20px 0;
      flex-wrap: nowrap;
    }

    .code-input {
      width: 50px;
      height: 50px;
      border: 2px solid #888;
      background: #121212;
      color: white;
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
    }

    .code-input:focus {
      outline: none;
      border-color: #8a2be2;
      box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
      transform: scale(1.05);
    }

    .code-input.filled {
      border-color: #44ff44;
      background: #1a3d1a;
    }

    input[type="password"], .form-button {
      padding: 14px;
      border-radius: 8px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    }

    input[type="password"] {
      border: 2px solid #888;
      background: #121212;
      color: white;
    }

    .form-button {
      background: linear-gradient(145deg, #8a2be2, #4b0082);
      border: 2px solid #ffffff22;
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .form-button:hover { filter: brightness(1.2); }
    .form-button:disabled { opacity: 0.5; cursor: not-allowed; }

    .message { font-size: 14px; color: #ccc; }
    .error { color: #ff4444; }
    .success { color: #44ff44; }
    .hidden { display: none; }

    @media (max-width: 480px) and (orientation: portrait) {

  body {
    align-items: center;
    padding: 16px;
  }

  .modal-content {
    padding: 22px;
    max-width: 360px;
  }

  h2 {
    font-size: 18px;
  }

  .message {
    font-size: 13px;
  }

  /* FORCE INLINE CODE INPUTS */
  .code-container {
    display: flex;
    flex-wrap: nowrap;        /* ðŸ”’ keep inline */
    justify-content: center;
    gap: 6px;
  }

  .code-input {
    width: 40px;
    height: 40px;
    font-size: 20px;
  }

  input[type="password"], .form-button {
    font-size: 15px;
    padding: 12px;
  }
}

  </style>
</head>
<body>

  <div id="verifyCodeModal" class="modal-content">
    <h2>Enter Verification Code</h2>
    <p class="message">A 6-digit code was sent to your email.</p>

    <div class="code-container">
      <input type="text" class="code-input" maxlength="1" data-index="0"/>
      <input type="text" class="code-input" maxlength="1" data-index="1"/>
      <input type="text" class="code-input" maxlength="1" data-index="2"/>
      <input type="text" class="code-input" maxlength="1" data-index="3"/>
      <input type="text" class="code-input" maxlength="1" data-index="4"/>
      <input type="text" class="code-input" maxlength="1" data-index="5"/>
    </div>

    <button class="form-button" id="verifyBtn" onclick="verifyCode()" disabled>Verify</button>
    <p id="codeMessage" class="error hidden"></p>
  </div>

  <div id="newPasswordModal" class="modal-content hidden">
    <h2>Set New Password</h2>
    <input type="password" id="newPassword" placeholder="New Password"/>
    <input type="password" id="confirmPassword" placeholder="Confirm Password"/>
    <button class="form-button" onclick="resetPassword()">Confirm</button>
    <p id="resetMessage" class="error hidden"></p>
  </div>

  <!-- JS IS UNCHANGED -->
  <script>
  const urlParams = new URLSearchParams(window.location.search);
  const email = decodeURIComponent(urlParams.get('email') || '');
  const token = decodeURIComponent(urlParams.get('token') || '');

  const codeInputs = document.querySelectorAll('.code-input');
  const verifyBtn = document.getElementById('verifyBtn');

  // focus first input on load
  window.addEventListener('load', () => {
    codeInputs[0]?.focus();
  });

  codeInputs.forEach((input, index) => {

    input.addEventListener('input', (e) => {
      let val = e.target.value;

      // allow digits only
      if (!/^\d$/.test(val)) {
        e.target.value = '';
        val = '';
      }

      // GREEN FILLED EFFECT
      if (val) {
        e.target.classList.add('filled');
        if (index < codeInputs.length - 1) {
          codeInputs[index + 1].focus();
        }
      } else {
        e.target.classList.remove('filled');
      }

      updateVerifyButton();
    });

    // backspace navigation
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && !input.value && index > 0) {
        codeInputs[index - 1].focus();
      }
      if (e.key === 'ArrowLeft' && index > 0) {
        codeInputs[index - 1].focus();
      }
      if (e.key === 'ArrowRight' && index < codeInputs.length - 1) {
        codeInputs[index + 1].focus();
      }
    });

    // paste support (mobile + desktop)
    input.addEventListener('paste', (e) => {
      e.preventDefault();
      const digits = e.clipboardData
        .getData('text')
        .replace(/\D/g, '')
        .slice(0, 6);

      digits.split('').forEach((digit, i) => {
        if (codeInputs[i]) {
          codeInputs[i].value = digit;
          codeInputs[i].classList.add('filled');
        }
      });

      updateVerifyButton();

      const next = [...codeInputs].find(i => !i.value);
      (next || codeInputs[5]).focus();
    });
  });

  function updateVerifyButton() {
    verifyBtn.disabled = ![...codeInputs].every(i => i.value);
  }

  function getCodeValue() {
    return [...codeInputs].map(i => i.value).join('');
  }

  function verifyCode() {
    if (getCodeValue().length !== 6) return;

    const modal = document.getElementById('verifyCodeModal');
    modal.classList.add('morph');

    setTimeout(() => {
      modal.classList.add('hidden');
      modal.classList.remove('morph');
      document.getElementById('newPasswordModal').classList.remove('hidden');
    }, 600);
  }

  function resetPassword() {
    alert("âœ… Password changed successfully!");
    window.location.href = "scene1.html";
  }
</script>

</body>
</html>
