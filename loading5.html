<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CHEMSAGA — Loading…</title>
<meta name="color-scheme" content="dark"/>

<link id="prefetchTarget" rel="prefetch" href="#">
<link rel="stylesheet" href="./assets/css/global-nocopypaste.css">

<style>
:root{
  --bg-1:#0a0416;
  --bg-2:#140a2b;
  --purple-1:165,31,209;

  /* TRUE GOLD */
  --gold:255,200,70;

  --tile-dk:#1b1033;
  --tile-md:#241247;

  --gap:8px;

  --tiles-x:12;
  --tiles-y:8;

  --col-step:120ms;
  --row-ripple:26ms;
  --tile-flash:520ms;
  --exit:420ms;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}

body{
  background:
    radial-gradient(1400px 900px at 10% 10%, rgba(var(--purple-1),0.16), transparent 60%),
    radial-gradient(1400px 900px at 90% 90%, rgba(var(--purple-1),0.12), transparent 60%),
    linear-gradient(135deg,var(--bg-1),var(--bg-2));
  display:grid;
  place-items:center;
  overflow:hidden;
  font-family:system-ui,Segoe UI,Arial;
}

/* ===== FULLSCREEN STAGE ===== */
.stage{
  width:100vw;
  height:100vh;
  position:relative;
  overflow:hidden;
}

/* ===== GRID ===== */
.tiles{
  position:absolute;
  inset:clamp(12px,2vw,20px);
  display:grid;
  grid-template-columns:repeat(var(--tiles-x),minmax(0,1fr));
  gap:var(--gap);
}

/* ===== TILE ===== */
.tile{
  aspect-ratio:1/1;
  border-radius:10px;
  background:linear-gradient(180deg,var(--tile-md),var(--tile-dk));
  position:relative;
  overflow:hidden;

  opacity:0;
  transform:translate3d(0,32px,0) scale(.96);
  will-change:transform,opacity;
}

/* subtle glass */
.tile::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(120% 80% at -10% -10%, rgba(255,255,255,.08), transparent 45%),
    radial-gradient(120% 80% at 110% 110%, rgba(255,255,255,.05), transparent 45%);
  mix-blend-mode:screen;
}

/* ===== ANIMATION ===== */
.tile.gold-seq{
  animation:
    tile-enter 460ms cubic-bezier(.22,.61,.36,1) forwards,
    mp-wave 780ms cubic-bezier(.22,.61,.36,1) forwards;
  animation-delay:
    var(--delay),
    calc(var(--delay) + 420ms);
}
@keyframes mp-wave{
  0%{
    background:linear-gradient(180deg,var(--tile-md),var(--tile-dk));
    box-shadow:none;
    transform:scale(1);
  }
  35%{
    background:
      linear-gradient(180deg,
        rgba(var(--gold),0.65),
        rgba(var(--gold),0.18)
      );
    box-shadow:
      0 0 14px rgba(var(--gold),.45),
      0 0 34px rgba(var(--gold),.25);
    transform:scale(1.06);
  }
  65%{
    background:
      linear-gradient(180deg,
        rgba(var(--purple-1),0.55),
        rgba(var(--purple-1),0.18)
      );
    box-shadow:
      0 0 16px rgba(var(--purple-1),.55),
      0 0 38px rgba(var(--purple-1),.35);
    transform:scale(1.04);
  }
  100%{
    background:
      linear-gradient(180deg,
        rgba(var(--tile-md),1),
        rgba(var(--tile-dk),1)
      );
    box-shadow:
      0 0 10px rgba(var(--purple-1),.25);
    transform:scale(1);
  }
}


@keyframes tile-enter{
  0%{
    opacity:0;
    transform:translate3d(0,32px,0) scale(.96);
  }
  70%{
    opacity:1;
    transform:translate3d(0,-1px,0) scale(1.01);
  }
  100%{
    opacity:1;
    transform:translate3d(0,0,0) scale(1);
  }
}

@keyframes gold-flash{
  0%{
    background:linear-gradient(180deg,var(--tile-md),var(--tile-dk));
  }
  60%{
    background:
      linear-gradient(180deg,
        rgba(var(--gold),0.70),
        rgba(var(--gold),0.18)
      );
    box-shadow:
      0 0 18px rgba(var(--gold),.55),
      0 0 48px rgba(var(--gold),.35);
  }
  100%{
    background:
      linear-gradient(180deg,
        rgba(var(--gold),0.28),
        rgba(var(--gold),0.08)
      );
    box-shadow:
      0 0 14px rgba(var(--gold),.35);
  }
}

/* ===== HUD ===== */
.hud{
  position:absolute;
  left:0;right:0;bottom:18px;
  padding:0 20px;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:900;
  letter-spacing:.1em;
  text-transform:uppercase;
}

.dot{
  width:10px;height:10px;border-radius:50%;
  background:rgb(var(--gold));
  box-shadow:
    0 0 10px rgba(var(--gold),.9),
    0 0 24px rgba(var(--gold),.5);
}

.bar{
  margin-top:10px;
  height:8px;
  border-radius:999px;
  background:rgba(255,255,255,.15); /* white track */
  overflow:hidden;
}

.bar i{
  display:block;
  height:100%;
  width:0%;

  /* WHITE ENERGY FILL */
  background:linear-gradient(90deg,
    rgba(255,255,255,0),
    rgba(255,255,255,.75),
    rgba(255,255,255,1)
  );

  box-shadow:
    0 0 12px rgba(255,255,255,.65),
    0 0 28px rgba(255,255,255,.35);
}


/* ===== EXIT ===== */
.leaving{
  animation:exit-fade var(--exit) cubic-bezier(.22,.61,.36,1) forwards;
}
@keyframes exit-fade{
  to{
    opacity:0;
    transform:scale(.985);
    filter:blur(1px);
  }
}

/* ===== REDUCED MOTION ===== */
@media (prefers-reduced-motion: reduce){
  .tile.gold-seq{animation:none!important}
}
</style>
</head>

<body>
<div class="stage" id="stage">
  <div class="tiles" id="tiles"></div>

  <div class="hud">
    <div class="brand"><span class="dot"></span>Starting…</div>
    <div class="bar"><i id="bar"></i></div>
  </div>
</div>

<script>
(function(){
  const u=new URL(location.href);
  const room=u.searchParams.get('room_id');
  const t=u.searchParams.get('t');
  if(!room||!t){
    location.replace('/Newchemsaga/public/multi2.html');
    return;
  }

  const TARGET=`/Newchemsaga/public/multi-tile.html?room_id=${room}&t=${t}`;
  document.getElementById('prefetchTarget').href=TARGET;

  const tiles=document.getElementById('tiles');
  const bar=document.getElementById('bar');
  const stage=document.getElementById('stage');

  const portrait=matchMedia('(max-width:680px)').matches;

  const COLS=portrait?7:12;
  const GAP =portrait?4:8;

  const rect=stage.getBoundingClientRect();
  const usableW=rect.width-40;
  const usableH=rect.height-100;

  const tileSize=(usableW-(COLS-1)*GAP)/COLS;
  const ROWS=Math.ceil(usableH/(tileSize+GAP));

  document.documentElement.style.setProperty('--tiles-x',COLS);
  document.documentElement.style.setProperty('--tiles-y',ROWS);
  document.documentElement.style.setProperty('--gap',GAP+'px');

  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      const tile=document.createElement('div');
      tile.className='tile gold-seq';

      const cx=(COLS-1)/2;
      const cy=(ROWS-1)/2;
      const delay=
        Math.abs(x-cx)*120*.6+
        Math.abs(y-cy)*26*2+
        Math.random()*20;

      tile.style.setProperty('--delay',delay+'ms');
      tiles.appendChild(tile);
    }
  }

  const DURATION=120*(COLS-1)+26*(ROWS-1)+520+260;
  const start=performance.now();
  let lastBar=0;

  function tick(now){
    const p=Math.min(1,(now-start)/DURATION);
    if(now-lastBar>16){
      bar.style.width=(p*100).toFixed(2)+'%';
      lastBar=now;
    }
    if(p<1) requestAnimationFrame(tick);
    else exit();
  }

  function exit(){
    stage.classList.add('leaving');
    setTimeout(()=>location.replace(TARGET),420);
  }

  requestAnimationFrame(tick);
})();
</script>

<script src="./assets/js/global-nocopypaste.js"></script>
</body>
</html>
